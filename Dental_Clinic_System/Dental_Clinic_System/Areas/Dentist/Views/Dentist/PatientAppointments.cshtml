@model IEnumerable<Dental_Clinic_System.Models.Data.Appointment>
@{
    ViewData["Title"] = "PatientAppointments";
    string statusColorClass = "status";
}

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản Lý Đặt Khám</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@400..800&display=swap"
          rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />
    <link rel="stylesheet" href="~/assets/css/sidebar.css" />
    <link rel="stylesheet" href="~/assets/css/headerAd.css" />
    <link rel="stylesheet" href="~/assets/css/dentistpatients.css" />
</head>

<div class="patients__management" style="padding: 40px">
    <table style="font-size: 2rem">
        <thead>
            <tr>
                <th>STT</th>
                <th>Bệnh nhân</th>
                <th>Chuyên Khoa</th>
                <th>Ngày hẹn</th>
                <th>Giờ hẹn</th>
                <th>Trạng thái</th>
                <th>Ngày tạo</th>
                <th>Hành động</th>
            </tr>
        </thead>
        @foreach (var appointment in Model)
        {
            <tbody>
                <tr style="vertical-align: middle; background-color:transparent;">
                    <td>@appointment.ID</td>
                    <td>@appointment.PatientRecords.FullName</td>
                    <td>@appointment.Specialty.Name</td>
                    <td>@appointment.Schedule.Date</td>
                    <td>@appointment.Schedule.TimeSlot.StartTime - @appointment.Schedule.TimeSlot.EndTime</td>
                    @switch (@appointment.AppointmentStatus)
                    {
                        @case "Đã Chấp Nhận": statusColorClass = "status approved"; break;
                        @case "Chờ Xác Nhận": statusColorClass = "status pending"; break;
                        @case "Đã Khám":    statusColorClass = "status complete"; break;
                        @case "Đã Hủy": statusColorClass = "status deny"; break;
                    }
                    <td><p class="@statusColorClass">@appointment.AppointmentStatus</p></td>
                    <td>2024-05-21</td>
                    <td>
                        <button type="button" class="btn show-popup" data-appointment-id="@appointment.ID"
                                                                    data-patient-name="@appointment.PatientRecords.FullName" 
                                                                    data-patient-gender="@appointment.PatientRecords.Gender" 
                                                                    data-patient-phone="@appointment.PatientRecords.PhoneNumber" 
                                                                    data-patient-email="@appointment.PatientRecords.Account?.Email" 
                                                                    data-patient-province="@appointment.PatientRecords.Province" 
                                                                    data-patient-district="@appointment.PatientRecords.District" 
                                                                    data-patient-ward="@appointment.PatientRecords.Ward" 
                                                                    data-patient-address="@appointment.PatientRecords.Address" 
                                                                    data-appointment-price="@appointment.TotalPrice" 
                                                                    data-appointment-status="@appointment.AppointmentStatus">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        }
    </table>
</div>

<!-- Dark overlay -->
<div class="modal-overlay" id="modalOverlay"></div>

<!-- Hidden block to display as a popup -->
<div class="modal-content" id="popupBlock">
    <h5 style="text-align:center;">Thông tin bệnh nhân đặt khám</h5>
    <form asp-controller="dentist" asp-action="changepatientappointment">
        <input type="hidden" id="appointmentID" name="AppointmentID" />
        <div class="d-flex justify-content-around">
            <div class="mb-3 w-75" style="margin-right:1%">
                <label for="patientName" class="form-label">Tên Bệnh Nhân</label>
                <span id="patientName" class="form-control bg-light bg-gradient"></span>
            </div>
            <div class="mb-3 w-25">
                <label for="patientGender" class="form-label">Giới Tính</label>
                <span id="patientGender" class="form-control bg-light bg-gradient"></span>
            </div>
        </div>
        <div class="mb-3">
            <label for="patientPhone" class="form-label">Số điện thoại</label>
            <span id="patientPhone" class="form-control bg-light bg-gradient"></span>
        </div>
        <div class="mb-3">
            <label for="patientEmail" class="form-label">Email</label>
            <span id="patientEmail" class="form-control bg-light bg-gradient"></span>
        </div>
        <div class="d-flex justify-content-between">
            <div class="mb-3 w-25" style=" margin-right:2%">
                <label for="patientProvince" class="form-label">Tỉnh Thành</label>
                <span id="patientProvince" class="form-control bg-light bg-gradient"></span>
            </div>
            <div class="mb-3 w-25" style="margin-right:2%">
                <label for="patientDistrict" class="form-label">Quận/Huyện</label>
                <span id="patientDistrict" class="form-control bg-light bg-gradient"></span>
            </div>
            <div class="mb-3 w-25" style=" margin-right:2%">
                <label for="patientWard" class="form-label">Phường/Xã</label>
                <span id="patientWard" class="form-control bg-light bg-gradient"></span>
            </div>
        </div>
        <div class="mb-3">
            <label for="patientAddress" class="form-label">Địa Chỉ</label>
            <span id="patientAddress" class="form-control bg-light bg-gradient"></span>
        </div>
        <div class="mb-3">
            <label for="appointmentPrice" class="form-label">Giá Khám</label>
            <span id="appointmentPrice" class="form-control bg-light bg-gradient"></span>
        </div>
        <div class="mb-3">
            <label for="appointmentStatus" class="form-label">Trạng Thái</label>
            <select class="form-control" id="appointmentStatus" name="AppointmentStatus">
                <option value="Chờ Xác Nhận">Chờ Xác Nhận</option>
                <option value="Đã Chấp Nhận">Đã Chấp Nhận</option>
                <option value="Đã Khám">Đã Khám</option>
                <option value="Đã Hủy">Đã Hủy</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Lưu</button>
        <button type="button" class="btn btn-secondary" id="closePopup">Đóng</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://kit.fontawesome.com/53f42380b0.js"
        crossorigin="anonymous"></script>
<script src="assets/js/tinymce/js/tinymce/tinymce.min.js"></script>
<script src="assets/js/richtexteditor.js"></script>
<script type="text/javascript" src="/richtexteditor/rte.js"></script>
<script type="text/javascript"
        src="/richtexteditor/plugins/all_plugins.js"></script>

<script>
    document.querySelectorAll('.show-popup').forEach(button => {
        button.addEventListener('click', (e) => {
            const appointmentID = e.currentTarget.getAttribute('data-appointment-id');
            const patientName = e.currentTarget.getAttribute('data-patient-name');
            const patientGender = e.currentTarget.getAttribute('data-patient-gender');
            const patientPhone = e.currentTarget.getAttribute('data-patient-phone');
            const patientEmail = e.currentTarget.getAttribute('data-patient-email');
            const patientProvince = e.currentTarget.getAttribute('data-patient-province');
            const patientDistrict = e.currentTarget.getAttribute('data-patient-district');
            const patientWard = e.currentTarget.getAttribute('data-patient-ward');
            const patientAddress = e.currentTarget.getAttribute('data-patient-address');
            const appointmentPrice = e.currentTarget.getAttribute('data-appointment-price');
            const appointmentStatus = e.currentTarget.getAttribute('data-appointment-status');

            document.getElementById('appointmentID').value = appointmentID;
            document.getElementById('patientName').textContent = patientName;
            document.getElementById('patientGender').textContent = patientGender;
            document.getElementById('patientPhone').textContent = patientPhone;
            document.getElementById('patientEmail').textContent = patientEmail;
            document.getElementById('patientProvince').textContent = patientProvince;
            document.getElementById('patientDistrict').textContent = patientDistrict;
            document.getElementById('patientWard').textContent = patientWard;
            document.getElementById('patientAddress').textContent = patientAddress;
            document.getElementById('appointmentPrice').textContent = appointmentPrice;
            document.getElementById('appointmentStatus').value = appointmentStatus;

            document.getElementById('popupBlock').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        });
    });

    document.getElementById('closePopup').addEventListener('click', () => {
        document.getElementById('popupBlock').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    });

    document.getElementById('modalOverlay').addEventListener('click', () => {
        document.getElementById('popupBlock').style.display = 'none';
        document.getElementById('modalOverlay').style.display = 'none';
    });
</script>
