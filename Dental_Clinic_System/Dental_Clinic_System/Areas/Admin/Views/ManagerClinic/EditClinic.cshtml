@model Dental_Clinic_System.Areas.Admin.ViewModels.AddClincVM

@{
	ViewData["Title"] = "Edit Clinic";
	Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<style>
	.text-New-Clinic {
		font-size: calc(1.375rem + 1.5vw);
	}

</style>

<!--SHOW THÔNG TIN CHI TIẾT PHÒNG KHÁM VÀ CHỈNH SỬA-->
<div class="modal-header">
	<h1 class="modal-title fs-10 text-New-Clinic" id="mainTitle">
		Thêm mới phòng khám
	</h1>
</div>

<div class="modal-dialog modal-dialog-centered form-modal-styles">
	<form id="clinicForm" action="~/Admin/ManagerClinic/EditClinic" method="post" class="modal-content" enctype="multipart/form-data">
		<input type="hidden" asp-for="ID" />
		<input type="hidden" asp-for="ClinicStatus" value="Hoạt động" />

		<div class="modal-body row">
			@* HIỂN THỊ LỖI *@
			<div asp-validation-summary="ModelOnly" class="text-danger"></div>

			<div class="clinic-name col-md-6">
				<label for="name">Tên phòng khám</label>
				<input type="text" name="Name" id="name" class="form-control" value="@Model.Name"/>
				<span asp-validation-for="Name" class="text-danger"></span>
			</div>
			<div class="clinic-tel col-md-6">
				<label for="basis">Cơ sở</label>
				<input type="text" name="Basis" id="basis" class="form-control" value="@Model.Basis"/>

			</div>
			<div class="clinic-manager col-md-6">
				<label for="manager">Người quản lý phòng khám</label>
				<select asp-for="ManagerID" asp-items="Model.UnassignedManagers" class="form-control">
					<option value="">-- Chọn quản lý phòng khám --</option>
				</select>
			</div>
			<div class="clinic-tel col-md-6">
				<label for="tel">Số điện thoại</label>
				<input type="tel" name="PhoneNumber" id="tel" class="form-control" value="@Model.PhoneNumber"/>
				<span asp-validation-for="PhoneNumber" class="text-danger"></span>
			</div>
			<div class="clinic-mail col-md-12">
				<label for="mail">Email</label>
				<input type="email" name="Email" id="mail" class="form-control" value="@Model.Email"/>
				<span asp-validation-for="Email" class="text-danger"></span>
			</div>

			<div class="clinic-province col-md-4">
				<label for="province">Tỉnh / Thành phố</label>
				<select id="province" title="Chọn Tỉnh Thành" name="Province" class="form-control">
					<option value="0">-- Chọn Tỉnh Thành --</option>
				</select>
			</div>
			<div class="clinic-district col-md-4">
				<label for="district">Quận / Huyện</label>
				<select id="district" title="Chọn Quận Huyện" name="District" class="form-control">
					<option value="0">-- Chọn Quận Huyện --</option>
				</select>
			</div>
			<div class="clinic-ward col-md-4">
				<label for="ward">Phường / Xã</label>
				<select id="ward" title="Chọn Phường Xã" name="Ward" class="form-control">
					<option value="0">-- Chọn Phường Xã --</option>
				</select>
			</div>
			<div class="clinic-address col-md-12">
				<label for="addrSpecialty">Địa chỉ phòng khám</label>
				<input type="text" name="Address" id="addrSpecialty" class="form-control" value="@Model.Address"/>
				<span asp-validation-for="Address" class="text-danger"></span>
			</div>
			<div class="clinic-image col-md-12">
				<label>Hình ảnh</label>
				<img src="@Model.Image" alt="" style="max-width: 300px; max-height: 300px;" />
				<input type="file" id="fileInput" class="form-control" />
				<input asp-for="Image" id="imageUrl" class="form-control" type="hidden" />
				<span asp-validation-for="Image" class="text-danger"></span>
			</div>
			<div class="clinic-desc col-md-12">
				<label>Mô tả phòng khám</label>
				<div id="container">
					<div id="editor">
						<textarea asp-for="Description" class="form-control"></textarea>
					</div>
				</div>
			</div>

		</div>
		<div class="modal-footer">
			<button type="button"
					class="close-btn btn"
					data-bs-dismiss="modal"
					id="newBtn">
				Quay lại
			</button>
			<button type="submit" class="submit-btn btn">
				Lưu
			</button>
		</div>
	</form>
</div>



@* Đưa ảnh lên firebase *@
<script src="~/assets/js/firebase_script2.js" type="module"></script>

@* Dùng editor *@
<script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/ckeditor.js"></script>
<script src="~/assets/js/richtexteditor2.js"></script>

@* Call API from https://esgoo.ne to get data*@
<script src="https://esgoo.net/scripts/jquery.js"></script>
<script>
	$(document).ready(function () {
		var savedProvince = '@Model.Province';
		var savedDistrict = '@Model.District';
		var savedWard = '@Model.Ward';

		function loadWards(idquan, callback) {
			$.getJSON('https://esgoo.net/api-tinhthanh/3/' + idquan + '.htm', function (data_phuong) {
				if (data_phuong.error == 0) {
					$("#ward").html('<option value="0">Phường Xã</option>');
					$.each(data_phuong.data, function (key_phuong, val_phuong) {
						var selected = (val_phuong.id == savedWard) ? ' selected' : '';
						$("#ward").append('<option value="' + val_phuong.id + '" data-fullname="' + val_phuong.full_name + '"' + selected + '>' + val_phuong.full_name + '</option>');
					});

					if (callback) {
						callback();
					}
				}
			});
		}

		function loadDistricts(idtinh, callback) {
			$.getJSON('https://esgoo.net/api-tinhthanh/2/' + idtinh + '.htm', function (data_quan) {
				if (data_quan.error == 0) {
					$("#district").html('<option value="0">Quận Huyện</option>');
					$("#ward").html('<option value="0">Phường Xã</option>');
					$.each(data_quan.data, function (key_quan, val_quan) {
						var selected = (val_quan.id == savedDistrict) ? ' selected' : '';
						$("#district").append('<option value="' + val_quan.id + '" data-fullname="' + val_quan.full_name + '"' + selected + '>' + val_quan.full_name + '</option>');
					});

					if (savedDistrict) {
						loadWards(savedDistrict, callback);
					} else if (callback) {
						callback();
					}
				}
			});
		}

		function loadProvinces(callback) {
			$.getJSON('https://esgoo.net/api-tinhthanh/1/0.htm', function (data_tinh) {
				if (data_tinh.error == 0) {
					$("#province").html('<option value="0">Tỉnh Thành</option>');
					$.each(data_tinh.data, function (key_tinh, val_tinh) {
						var selected = (val_tinh.id == savedProvince) ? ' selected' : '';
						$("#province").append('<option value="' + val_tinh.id + '" data-fullname="' + val_tinh.full_name + '"' + selected + '>' + val_tinh.full_name + '</option>');
					});

					if (savedProvince) {
						loadDistricts(savedProvince, callback);
					} else if (callback) {
						callback();
					}
				}
			});
		}

		function setInitialValues() {
			if (savedProvince) {
				$("#province").val(savedProvince);
				$("#province").trigger('change');
			}
			if (savedDistrict) {
				$("#district").val(savedDistrict);
				$("#district").trigger('change');
			}
			if (savedWard) {
				$("#ward").val(savedWard);
			}
		}

		loadProvinces(setInitialValues);

		$("#province").change(function (e) {
			var selectedOption = $(this).find('option:selected');
			var idtinh = selectedOption.val();
			var fullnameTinh = selectedOption.data('fullname');
			$('#Province').val(fullnameTinh);

			// Load districts based on selected province
			loadDistricts(idtinh);
		});

		$("#district").change(function (e) {
			var selectedOption = $(this).find('option:selected');
			var idquan = selectedOption.val();
			var fullnameQuan = selectedOption.data('fullname');
			$('#District').val(fullnameQuan);

			// Load wards based on selected district
			loadWards(idquan);
		});

		$("#ward").change(function (e) {
			var selectedOption = $(this).find('option:selected');
			var fullnamePhuong = selectedOption.data('fullname');
			$('#Ward').val(fullnamePhuong);
		});
	});
</script>

<script>
	//Đợi cho document được tải hoàn chỉnh
	document.addEventListener("DOMContentLoaded", function () {
		// Lấy button "Close"
		var newBtn = document.getElementById("newBtn");

		// Nếu button tồn tại
		if (newBtn) {
			// Thêm click
			newBtn.addEventListener("click", function () {
				// Chuyển hướng đến URL của view khác
				window.location.href = "/Admin/ManagerClinic/ListClinic";
			});
		}
	});
</script>




@* 
<div class="modal-header">
	<h5 class="modal-title" id="clinicModalLabel">Thông tin chi tiết phòng khám</h5>
</div>

<form action="~/Admin/ManagerClinic/EditClinic" method="post">
	<input type="hidden" asp-for="ID" />

	<div class="modal-body">
		<div class="row">
			<div class="col-md-6">
				<!-- Hình ảnh phòng khám -->
				<img id="clinicImage" src="" alt="Clinic Image" class="img-fluid">
			</div>
			<div class="col-md-6">
				<div class="row">
					<div class="col-md-12">
						<!-- Tên phòng khám -->
						<div class="form-group">
							<label for="name">Tên phòng khám</label>
							<input type="text" class="form-control" id="name" name="Name">
							<span asp-validation-for="Name" class="text-danger"></span>
						</div>
					</div>
					<div class="col-md-12">
						<!-- Cơ sở -->
						<div class="form-group">
							<label for="basis">Cơ sở</label>
							<input type="text" class="form-control" id="basis" name="Basis">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Quản lý -->
						<div class="form-group">
							<label for="manager">Quản lý phòng khám: </label>
							<input type="text" class="form-control" id="manager" name="managerName">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Hotline -->
						<div class="form-group">
							<label for="phone">Hotline</label>
							<input type="tel" class="form-control" id="phone" name="PhoneNumber">
							<span asp-validation-for="PhoneNumber" class="text-danger"></span>
						</div>
					</div>
					<div class="col-md-12">
						<!-- Email -->
						<div class="form-group">
							<label for="emailInput">Email</label>
							<input type="email" class="form-control" id="emailInput" name="email">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Địa chỉ -->
						<div class="form-group">
							<label for="addressInput">Địa chỉ</label>
							<input type="text" class="form-control" id="addressInput" name="address">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Tỉnh/Thành phố -->
						<div class="form-group">
							<label for="provinceInput">Tỉnh/Thành phố</label>
							<input type="text" class="form-control" id="provinceInput" name="province">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Quận/Huyện -->
						<div class="form-group">
							<label for="districtInput">Quận/Huyện</label>
							<input type="text" class="form-control" id="districtInput" name="district">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Phường/Xã -->
						<div class="form-group">
							<label for="wardInput">Phường/Xã</label>
							<input type="text" class="form-control" id="wardInput" name="ward">
						</div>
					</div>
					<div class="col-md-12">
						<!-- Mô tả phòng khám -->
						<div class="form-group">
							<label for="descriptionInput">Mô tả phòng khám</label>
							<textarea class="form-control" id="descriptionInput" rows="3" name="description"></textarea>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="submit" class="btn btn-primary">Lưu chỉnh sửa</button>
		<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Quay lại</button>
	</div>
</form>

 *@