@model IEnumerable<Dental_Clinic_System.Areas.Admin.ViewModels.ManagerAccountVM>

@{
	ViewData["Title"] = "ListAccount";
	Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<!-- Thông báo lỗi bị trùng -->
@if (!ViewData.ModelState.IsValid)
{
	<div class="alert alert-danger" role="alert">
		@foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
		{
			<span>@error.ErrorMessage</span>

			<br />
		}
	</div>
}

<style>
	.inline-block {
		display: inline-block;
		vertical-align: top;
	}

	.form-inline {
		display: inline-block;
		margin: 0;
	}

	.account__management .color-trash button {
		background: rgb(255, 66, 66); /* Nền đỏ */
		color: white; /* Màu chữ trắng */
	}
</style>


<!-- account management header -->
<div class="account__management__header">
	<div class="title">Quản lý tài khoản</div>
	<div class="action-btn">
		<!-- TÌM KIẾM -->
		<form action="~/Admin/Account/SearchAccount" method="get">
			<input type="hidden" name="role" value="@ViewBag.role" />
			<div class="search__bar">
				<input type="search" placeholder="Tìm kiếm ..." name="keyword" />
			</div>
		</form>

		<button type="button"
				data-bs-toggle="modal"
				data-bs-target="#myModal"
				class="add__new">
			+ New
		</button>
	</div>
</div>


<!-- Modal For Add new User -->
<!-- THÊM MỚI NGƯỜI DÙNG-->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="mainTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered form-modal-styles">
		<form action="~/Admin/Account/AddAccount" method="POST" class="modal-content" onsubmit="return validateForm()">
			<div class="modal-header">
				<h1 class="modal-title fs-10" id="mainTitle">
					Thêm mới người dùng
				</h1>
				<button type="button"
						class="btn-close"
						data-bs-dismiss="modal"
						aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="user-name">
					<label for="username">Tên người dùng</label>
					<input type="text" name="Username" id="username" required />
					<span id="usernameError" class="text-danger"></span>
				</div>
				<div class="user-password">
					<label for="password">Mật khẩu</label>
					<input type="password" name="Password" id="password" required />
					<span id="passwordError" class="text-danger"></span>
				</div>
				<div class="user-tel">
					<label for="phonenumber">Số điện thoại</label>
					<input type="tel" name="PhoneNumber" id="phonenumber" />
					<span id="phoneNumberError" class="text-danger"></span>
				</div>
				<div class="user-mail">
					<label for="email">Email</label>
					<input type="email" name="Email" id="email" required />
					<span id="emailError" class="text-danger"></span>
				</div>
				<div class="user-address">
					<label for="address">Địa chỉ</label>
					<input type="text" name="Address" id="address" />
				</div>
				<input type="hidden" name="Role" id="role" value="@ViewBag.role" />
			</div>

			<div class="modal-footer">
				<button type="button" class="close-btn btn" data-bs-dismiss="modal">
					Close
				</button>
				<button type="submit" class="submit-btn btn">
					Save changes
				</button>
			</div>
		</form>
	</div>
</div>


<table class="table table-striped mt-5" style="font-size: 1.6rem">
	<thead>
		<tr>
			<th class="text-center">STT</th>
			<th>Tên người dùng</th>
			<th>Email</th>
			<th>Số điện thoại</th>
			<th>Địa chỉ</th>
			<th>Hành động</th>
		</tr>
	</thead>
	<tbody id="myTableBody">
		@if (Model != null && Model.Any())
		{
			int stt = 1;
			@foreach (var account in Model)
			{
				<tr style="vertical-align: middle">
					<td>@stt</td>
					<td>
						@* <img src="~/assets/images/avatar.jpg" alt="" /> *@
						@account.Username
					</td>
					<td>@account.Email</td>
					<td>@account.PhoneNumber</td>
					<td>@account.Address</td>
					<td>@account.Role</td>
					@* <td>@account.Status</td> *@
					<td>
						<a href="@Url.Action("EditAccount", "Account", new {id = account.Id})" class="inline-block">
							<button type="button">
								<i class="bx bxs-edit"></i>
							</button>
						</a>

						<form action="~/Admin/Account/HiddenAccountStatus" method="post" class="form-inline">
							<input type="hidden" name="username" value="@account.Username" />
							<input type="hidden" name="status" value="Bị khóa" />
							<input type="hidden" name="role" value="@ViewBag.Role" />
							<a href="#!" class="color-trash">
								<button type="submit">
									<i class="bx bxs-trash"></i>
								</button>
							</a>
						</form>
					</td>
				</tr>
				stt++;
			}
		}
	</tbody>
</table>

<!-- ========== PAGINATION  ========== -->
<ul class="pagination" id="pagination">
	<!-- <li class="page-item">
		<a class="page-link" href="#" style="font-size: 2rem">Previous</a>
	</li>
	<li class="page-item">
		<a class="page-link" href="#" style="font-size: 2rem">1</a>
	</li>
	<li class="page-item">
		<a class="page-link" href="#" style="font-size: 2rem">2</a>
	</li>
	<li class="page-item">
		<a class="page-link" href="#" style="font-size: 2rem">3</a>
	</li>
	<li class="page-item">
		<a class="page-link" href="#" style="font-size: 2rem">Next</a>
	</li> -->
</ul>


<!-- Thông báo lỗi -->
@section Scripts {
	<script>
		function validateForm() {
			let isValid = true;

			//Xác thực Username
			const username = document.getElementById('username').value;
			const usernameError = document.getElementById('usernameError');
			const usernameRegex = /^[a-zA-Z][a-zA-Z0-9]{2,29}$/;
			if (!usernameRegex.test(username)) {
				usernameError.innerText = "Tên người dùng phải có ít nhất 3 ký tự, chỉ chứa các chữ cái và số, và bắt đầu bằng chữ cái.";
				isValid = false;
			} else {
				usernameError.innerText = "";
			}

			//Xác thực mật khẩu
			const password = document.getElementById('password').value;
			const passwordError = document.getElementById('passwordError');
			const passwordRegex = /^[a-zA-Z][a-zA-Z0-9]{2,29}$/;
			if (!passwordRegex.test(password)) {
				passwordError.innerText = "Mật khẩu phải có ít nhất 3 ký tự, chỉ chứa các chữ cái và số, và bắt đầu bằng chữ cái.";
				isValid = false;
			} else {
				passwordError.innerText = "";
			}

			//Xác thực Email
			const email = document.getElementById('email').value;
			const emailError = document.getElementById('emailError');
			if (email.length < 3 || email.length > 50) {
				emailError.innerText = "Email phải có ít nhất 3 ký tự và không vượt quá 50 ký tự.";
				isValid = false;
			} else {
				emailError.innerText = "";
			}

			//Xác thực số điện thoại
			const phoneNumber = document.getElementById('phonenumber').value;
			const phoneNumberError = document.getElementById('phoneNumberError');
			const phoneNumberRegex = /^\d{9,11}$/;
			if (!phoneNumberRegex.test(phoneNumber)) {
				phoneNumberError.innerText = "Số điện thoại phải có độ dài từ 9 đến 11 số.";
				isValid = false;
			} else {
				phoneNumberError.innerText = "";
			}

			return isValid;
		}
	</script>
}