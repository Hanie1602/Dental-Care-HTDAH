@model Dental_Clinic_System.Models.Data.Clinic

@{
    ViewData["Title"] = "Edit"; 
    Layout = "_LayoutManager";
}
@section Styles {
    <style>
        .sidebar .nav-item a.Quan_ly_phong_kham {
            color: #fff;
            background: #4880ff;
        }

        .manager__management__header {
            justify-content: space-around;
        }

        .manager__management__clinic select {
            font-size: 2rem;
            padding: 8px 10px;
            background: #FFFFF;
        } 
    </style>
}
<div class="manager__management">
    <div class="manager__management__header">
        <div class="title">Quản lý phòng khám</div>
    </div>
    <form asp-action="Edit" class="manager__management__clinic row">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="ID" />
        
        <div class="col-md-6">
            <label>Tên phòng khám</label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label>Cơ sở</label>
            <input asp-for="Basis" class="form-control" />
            <span asp-validation-for="Basis" class="text-danger"></span>
        </div>
        <div class="col-md-12 image-file">
            <label>Hình ảnh</label>
            <input asp-for="Image" class="form-control"/>
            <span asp-validation-for="Image" class="text-danger"></span>
        </div>




        @* <div class="col-md-6">
            <label>Tỉnh/Thành phố</label>
            <input asp-for="Province" class="form-control" />
            <span asp-validation-for="Province" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label>Quận/Huyện</label>
            <input asp-for="District" class="form-control" />
            <span asp-validation-for="District" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label>Phường/Xã</label>
            <input asp-for="Ward" class="form-control" />
            <span asp-validation-for="Ward" class="text-danger"></span>
        </div> *@

        <div class="col-md-6">
            <label for="province">Tỉnh / Thành phố </label>
            <select id="tinh" title="Chọn Tỉnh Thành" asp-for="@Model.Province" class="form-control">
                <option value="0">Tỉnh Thành</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="district">Quận / Huyện </label>
            <select id="quan" title="Chọn Quận Huyện" asp-for="@Model.District" class="form-control">
                <option value="0">Quận Huyện</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="ward">Phường / Xã </label>
            <select id="phuong" title="Chọn Phường Xã" asp-for="@Model.Ward" class="form-control">
                <option value="0">Phường Xã</option>
            </select>
        </div>

        <div class="col-md-12">
            <label>Địa chỉ</label>
            <input asp-for="Address" class="form-control" />
            <span asp-validation-for="Address" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label>Email</label>
            <input asp-for="Email" class="form-control" />
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
        <div class="col-md-6">
            <label>Số điện thoại liên hệ</label>
            <input asp-for="PhoneNumber" class="form-control" />
            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
        </div>
        <div class="col-md-12">
            <label>Mô tả phòng khám</label>
            
            <div id="container">
                <div id="editor" >
                    <textarea asp-for="Description" class="form-control"></textarea>
                </div>
            </div>
        </div>
        <div class="col-md-6">
             <input asp-for="ClinicStatus" class="form-control" type="hidden"/>
        </div>
        <div class="col-md-6">
            <input asp-for="ManagerID" class="form-control" type="hidden" />
        </div>
        <div class="col-md-12">
            <button type="submit" class="btn">Lưu</button>
            <button type="reset" class="btn">Đặt lại</button>
        </div>
    </form>
</div>

@section Scripts {
    @* Dùng editor *@
    <script src="https://cdn.ckeditor.com/ckeditor5/41.4.2/super-build/ckeditor.js"></script>
    <script src="~/assets/js/richtexteditor2.js"></script>

    @* Call API from https://esgoo.ne to get data*@
    <script src="https://esgoo.net/scripts/jquery.js"></script>
    <script>
        $(document).ready(function () {
            var savedProvince = '@Model.Province';
            var savedDistrict = '@Model.District';
            var savedWard = '@Model.Ward';

            // Chuyển đổi giá trị chuỗi sang số
            var savedProvinceId = parseInt(savedProvince, 10);
            var savedDistrictId = parseInt(savedDistrict, 10);
            var savedWardId = parseInt(savedWard, 10);

            function loadWards(idquan, callback) {
                $.getJSON('https://esgoo.net/api-tinhthanh/3/' + idquan + '.htm', function (data_phuong) {
                    if (data_phuong.error == 0) {
                        $("#phuong").html('<option value="0">Phường Xã</option>');
                        $.each(data_phuong.data, function (key_phuong, val_phuong) {
                            var selected = (val_phuong.id == savedWardId) ? ' selected' : '';
                            $("#phuong").append('<option value="' + val_phuong.id + '" data-fullname="' + val_phuong.full_name + '"' + selected + '>' + val_phuong.full_name + '</option>');
                        });

                        if (callback) {
                            callback();
                        }
                    }
                });
            }

            function loadDistricts(idtinh, callback) {
                $.getJSON('https://esgoo.net/api-tinhthanh/2/' + idtinh + '.htm', function (data_quan) {
                    if (data_quan.error == 0) {
                        $("#quan").html('<option value="0">Quận Huyện</option>');
                        $("#phuong").html('<option value="0">Phường Xã</option>');
                        $.each(data_quan.data, function (key_quan, val_quan) {
                            var selected = (val_quan.id == savedDistrictId) ? ' selected' : '';
                            $("#quan").append('<option value="' + val_quan.id + '" data-fullname="' + val_quan.full_name + '"' + selected + '>' + val_quan.full_name + '</option>');
                        });

                        if (savedDistrictId) {
                            loadWards(savedDistrictId, callback);
                        } else if (callback) {
                            callback();
                        }
                    }
                });
            }

            function loadProvinces(callback) {
                $.getJSON('https://esgoo.net/api-tinhthanh/1/0.htm', function (data_tinh) {
                    if (data_tinh.error == 0) {
                        $("#tinh").html('<option value="0">Tỉnh Thành</option>');
                        $.each(data_tinh.data, function (key_tinh, val_tinh) {
                            var selected = (val_tinh.id == savedProvinceId) ? ' selected' : '';
                            $("#tinh").append('<option value="' + val_tinh.id + '" data-fullname="' + val_tinh.full_name + '"' + selected + '>' + val_tinh.full_name + '</option>');
                        });

                        if (savedProvinceId) {
                            loadDistricts(savedProvinceId, callback);
                        } else if (callback) {
                            callback();
                        }
                    }
                });
            }

            function setInitialValues() {
                if (savedProvinceId) {
                    $("#tinh").val(savedProvinceId);
                    $("#tinh").trigger('change');
                }
                if (savedDistrictId) {
                    $("#quan").val(savedDistrictId);
                    $("#quan").trigger('change');
                }
                if (savedWardId) {
                    $("#phuong").val(savedWardId);
                }
            }

            loadProvinces(setInitialValues);

            $("#tinh").change(function (e) {
                var selectedOption = $(this).find('option:selected');
                var idtinh = selectedOption.val();
                var fullnameTinh = selectedOption.data('fullname');
                $('#Province').val(fullnameTinh);

                // Load districts based on selected province
                loadDistricts(idtinh);
            });

            $("#quan").change(function (e) {
                var selectedOption = $(this).find('option:selected');
                var idquan = selectedOption.val();
                var fullnameQuan = selectedOption.data('fullname');
                $('#District').val(fullnameQuan);

                // Load wards based on selected district
                loadWards(idquan);
            });

            $("#phuong").change(function (e) {
                var selectedOption = $(this).find('option:selected');
                var fullnamePhuong = selectedOption.data('fullname');
                $('#Ward').val(fullnamePhuong);
            });
        });
    </script>

}

<div style="height: 20px;"></div>

